# 数据迁移说明

## 📦 版本升级时的数据保留

### 自动保留的数据

SnippetsHub 使用以下方式存储用户数据，**在应用更新时会自动保留**：

#### 1. **LocalStorage 数据**
所有以下数据都存储在浏览器的 localStorage 中，更新应用不会影响：

- ✅ **代码片段** - 所有代码片段和文件夹
- ✅ **TODO 列表** - 所有待办事项和标签
- ✅ **Markdown 文档** - 文档内容和历史快照
- ✅ **应用设置** - 主题、编辑器配置等
- ✅ **快捷键配置** - 自定义快捷键
- ✅ **云同步配置** - GitHub 令牌和同步设置

#### 2. **SQLite 数据库**
以下数据存储在本地 SQLite 数据库中：

- ✅ **项目工作区** - 所有项目和工作区信息
- ✅ **Git 仓库** - Git 集成配置

数据库文件位置：
- **macOS**: `~/Library/Application Support/com.noah.snippetshub/`
- **Windows**: `%APPDATA%\com.noah.snippetshub\`
- **Linux**: `~/.local/share/com.noah.snippetshub/`

### 数据存储位置

```
应用数据目录/
├── localStorage (WebView)
│   ├── snippets          # 代码片段
│   ├── todos             # 待办事项
│   ├── markdown          # Markdown 文档
│   └── settings          # 应用设置
│
└── snippetshub.db        # SQLite 数据库
    ├── workspaces        # 工作区
    ├── projects          # 项目
    └── git_repositories  # Git 仓库
```

## 🔄 版本升级流程

### 1. **更新检查**
- 应用启动 3 秒后自动检查更新
- 也可以在设置页面手动检查

### 2. **下载更新**
- 从 GitHub Releases 下载最新版本
- 显示下载进度
- 自动验证数字签名

### 3. **安装更新**
- 自动安装新版本
- **不会删除任何用户数据**
- 安装完成后重启应用

### 4. **数据验证**
重启后，应用会自动：
- 加载 localStorage 中的所有数据
- 连接到现有的 SQLite 数据库
- 所有功能正常工作，数据完整保留

## 🛡️ 数据安全保障

### 为什么数据会自动保留？

1. **WebView 持久化**
   - Tauri 使用系统原生 WebView
   - localStorage 数据存储在系统级别
   - 应用更新不会清除 WebView 数据

2. **数据库文件独立**
   - SQLite 数据库是独立文件
   - 存储在用户数据目录
   - 不在应用程序目录中

3. **应用更新原理**
   - 只替换应用程序二进制文件
   - 不触碰用户数据目录
   - 数据目录完全独立

## 📋 版本兼容性

### 数据格式版本

当前数据格式版本：`1.0.0`

| 应用版本 | 数据格式版本 | 向下兼容 | 说明 |
|---------|------------|---------|------|
| 1.0.x   | 1.0.0      | ✅      | 初始版本 |
| 1.1.x   | 1.0.0      | ✅      | 功能增强，数据结构不变 |
| 2.0.x   | 2.0.0      | ✅      | 可能需要数据迁移脚本 |

### 如果需要数据迁移

对于重大版本升级（如 1.x → 2.x），如果数据格式发生变化：

1. **自动迁移脚本**
   - 应用启动时自动检测数据版本
   - 运行迁移脚本升级数据格式
   - 保留原始数据备份

2. **迁移失败处理**
   - 显示错误提示
   - 提供数据导出功能
   - 联系技术支持

## 🔧 手动备份（可选）

虽然数据会自动保留，但建议定期备份：

### 1. **导出代码片段**
```
设置 → 数据管理 → 导出所有片段 (JSON)
```

### 2. **导出 TODO 列表**
```
TODO 列表 → 更多 → 导出 (JSON)
```

### 3. **导出 Markdown 文档**
```
Markdown 编辑器 → 导出 → Markdown/HTML
```

### 4. **复制数据库文件**
手动复制 `snippetshub.db` 文件到安全位置

## 📞 技术支持

如果在版本升级后遇到数据问题：

1. **检查数据目录**
   - 确认数据库文件仍然存在
   - 检查文件权限

2. **查看应用日志**
   - macOS: `~/Library/Logs/com.noah.snippetshub/`
   - Windows: `%APPDATA%\com.noah.snippetshub\logs\`

3. **联系支持**
   - GitHub Issues
   - 提供错误日志和系统信息

## ✅ 测试验证

### 更新前
1. 记录当前版本号
2. 记录代码片段数量
3. 记录 TODO 数量
4. 记录 Markdown 文档数量

### 更新后
1. 验证版本号已更新
2. 确认所有代码片段存在
3. 确认所有 TODO 存在
4. 确认所有 Markdown 文档存在
5. 测试创建、编辑、删除功能

## 🎯 最佳实践

1. **定期更新**
   - 及时安装安全更新
   - 享受新功能和性能改进

2. **定期备份**
   - 虽然数据会保留，但备份是好习惯
   - 每月导出一次数据

3. **测试新版本**
   - 更新后验证关键功能
   - 报告任何异常行为

4. **阅读更新说明**
   - 了解新功能
   - 注意重大变更

---

**总结**：SnippetsHub 的数据在版本更新时会**自动完整保留**，无需手动迁移。数据存储在系统级别的独立位置，应用更新只替换程序文件，不会影响用户数据。
